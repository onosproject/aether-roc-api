import 	(
    "github.com/onosproject/aether-roc-api/pkg/utils"
    "github.com/onosproject/aether-roc-api/pkg/rbac_1_0_0/types"
   	"github.com/onosproject/aether-roc-api/pkg/utils"
   	modelplugin "github.com/onosproject/config-models/modelplugin/rbac-1.0.0/rbac_1_0_0"
)

{{range .Types}}
// {{printf "gnmiDelete%s" .TypeName}} deletes an instance of {{.JsonName}}.
func (i *ServerImpl) {{printf "gnmiDelete%s" .TypeName}}(ctx context.Context,
    openApiPath string, target types.Target, args ...string) error {

    gnmiSet, err := utils.NewGnmiSetDeleteRequest(openApiPath, string(target), args...)
    if err != nil {
        return err
    }
    log.Infof("gnmiSetRequest %s", gnmiSet.String())
    _, err = i.GnmiClient.Set(ctx, gnmiSet)

    return err
}

// {{printf "gnmiGet%s" .TypeName}} returns an instance of {{.JsonName}}.
func (i *ServerImpl) {{printf "gnmiGet%s" .TypeName}}(ctx context.Context,
    openApiPath string, target types.Target, args ...string) (*types.{{.TypeName}}, error) {

    gnmiGet, err := utils.NewGnmiGetRequest(openApiPath, string(target), args...)
    if err != nil {
        return nil, err
    }
    log.Infof("gnmiGetRequest %s", gnmiGet.String())
	gnmiJsonVal, err := utils.GetResponseUpdate(i.GnmiClient.Get(ctx, gnmiGet))
	if err != nil {
		return nil, err
	}
	if gnmiJsonVal == nil {
	    return nil, nil
	}

	log.Infof("gNMI Json %s", string(gnmiJsonVal.JsonVal))
    var gnmiResponse modelplugin.Device
	if err = modelplugin.Unmarshal(gnmiJsonVal.JsonVal, &gnmiResponse); err != nil {
	    return nil, fmt.Errorf("error unmarshalling gnmiResponse %v", err)
	}
	mpd := ModelPluginDevice{
	    device: gnmiResponse,
	}

    return mpd.{{printf "handlePropList%s" .TypeName}}()
}

// {{printf "gnmiPost%s" .TypeName}} adds an instance of {{.JsonName}}.
func (i *ServerImpl) {{printf "gnmiPost%s" .TypeName}}(ctx context.Context, body []byte,
    openApiPath string, target types.Target, args ...string) (*string, error) {

    {{ if eq .JsonName "target"}}return nil, fmt.Errorf("Not implemented")
    {{else}}
	jsonObj := new(types.{{.JsonName}})
	if err := json.Unmarshal(body, jsonObj); err != nil {
		return nil, fmt.Errorf("unable to unmarshal JSON as types.{{.JsonName}} %v", err)
	}
	gnmiObj, err := encodeToGnmi{{.JsonName}}(jsonObj)
	if err != nil {
		return nil, fmt.Errorf("unable to convert types.RbacV100targetRbacRole to gNMI %v", err)
	}
    gnmiSet, err := utils.NewGnmiSetUpdateRequest(openApiPath, string(target), gnmiObj, args...)
    if err != nil {
        return nil, err
    }
    log.Infof("gnmiSetRequest %s", gnmiSet.String())
    gnmiSetResponse, err := i.GnmiClient.Set(ctx, gnmiSet)
    if err != nil {
        return nil, fmt.Errorf(" %v", err)
    }
    return utils.ExtractExtension100(gnmiSetResponse), nil{{end}}
}

{{end}}

type Translator interface {
    {{range .Types}}
    {{printf "handlePropList%s" .TypeName}}() ({{printf "*types.%s" .TypeName}}, error){{end}}
}
